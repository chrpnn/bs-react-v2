import{t as n,x as y,j as s,d as D,y as F,e as _,q as w,w as S,o as C,f as E}from"./index-P98SA6Id.js";import{u as N}from"./useAuth-_kAC9Tn6.js";import{F as $}from"./Footer-B0Cxkp2R.js";import{S as k}from"./SearchBar-Cg0I1tzS.js";const G="_root_1kb9r_1",R="_userInfo_1kb9r_23",v={root:G,userInfo:R};function B({friend:r}){const[a,d]=n.useState(0),[l,o]=n.useState(0),[c,e]=n.useState(r);return n.useEffect(()=>{const i=y(),m=()=>{const f=D(i,`users/${r.uid}`),h=F(f,p=>{e(p.data())});return()=>h()},x=()=>{const f=_(i,`users/${r.uid}/games`),h=w(f),p=F(h,A=>{const g=A.docs.map(j=>j.data());d(g.length);const q=g.filter(j=>j.status==="win").length;o(q/g.length*100)});return()=>p()},t=m(),u=x();return()=>{t(),u()}},[r.uid]),s.jsxs("div",{className:v.root,children:[s.jsx("img",{src:c.avatarURL,alt:"аватар"}),s.jsx("p",{children:c.name}),s.jsxs("div",{className:v.userInfo,children:[s.jsxs("p",{children:["Игры: ",a]}),s.jsxs("p",{children:["Процент побед: ",l.toFixed(1),"%"]})]})]})}const I="_root_1ud0u_1",V="_input_1ud0u_12",z="_button_1ud0u_21",M="_error_1ud0u_34",b={root:I,input:V,button:z,error:M};function U({onClose:r}){const[a,d]=n.useState(""),[l,o]=n.useState(""),[c,e]=n.useState(""),i=y(),m=N(),x=async()=>{if(!m){e("User is not defined");return}try{const t=w(_(i,"users"),S("name","==",a),S("email","==",l)),u=await C(t);if(u.empty){e("User with this name and email not found");return}const f=u.docs[0],h=f.data(),p={uid:f.id,name:h.name,avatar:h.avatar||"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS5iqy7AzrG-dXXWp76jDB7n7Bsz98MlkOqDg&s"};await E(D(_(i,`users/${m.uid}/friends`),p.uid),p),d(""),o(""),e(""),r()}catch(t){console.error("Error adding friend:",t),e("Error adding friend")}};return s.jsxs("div",{className:b.root,children:[s.jsx("input",{type:"text",value:a,onChange:t=>d(t.target.value),placeholder:"Введите имя...",className:b.input}),s.jsx("input",{type:"email",value:l,onChange:t=>o(t.target.value),placeholder:"Введите email...",className:b.input}),s.jsx("button",{onClick:x,className:b.button,children:"Добавить друга"}),c&&s.jsx("p",{className:b.error,children:c})]})}const L="_root_m5ymz_1",W={root:L};function K(){const[r,a]=n.useState(!1),[d,l]=n.useState([]),o=N();n.useEffect(()=>{if(!o)return;const e=y(),i=_(e,`users/${o.uid}/friends`),m=F(i,x=>{const t=x.docs.map(u=>({...u.data(),uid:u.id}));l(t)});return()=>m()},[o]);const c=()=>{a(!r)};return s.jsxs("div",{className:W.root,children:[s.jsx(k,{onAddClick:c}),r&&s.jsx(U,{onClose:()=>a(!1)}),d.map(e=>s.jsx(B,{friend:e},e.uid)),s.jsx($,{})]})}export{K as default};
